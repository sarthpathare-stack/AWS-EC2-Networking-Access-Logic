#!/usr/bin/env python3
"""
EC2 LAUNCH SIMULATOR
====================
Shows Control Plane & Data Plane phases
"""

import time
import random

def clear_screen():
    """Clear screen"""
    print("\n" * 50)

def print_header():
    """Print header"""
    print("=" * 50)
    print("ðŸš€ EC2 LAUNCH SIMULATOR")
    print("=" * 50)
    print()

def simulate_control_plane():
    """Simulate Control Plane checks"""
    print("ðŸ“‹ CONTROL PLANE CHECKS")
    print("-" * 30)
    
    checks = [
        ("IAM Permission", 0.9),      # 90% success
        ("AMI Exists", 0.8),          # 80% success  
        ("Subnet Exists", 0.95),      # 95% success
        ("Security Group", 0.7),      # 70% success
        ("Key Pair", 0.6),            # 60% success
    ]
    
    all_passed = True
    results = []
    
    for check_name, success_rate in checks:
        print(f"Checking {check_name}...", end=" ")
        time.sleep(0.5)
        
        passed = random.random() < success_rate
        if passed:
            print("âœ… PASS")
        else:
            print("âŒ FAIL")
            all_passed = False
        
        results.append((check_name, passed))
        time.sleep(0.3)
    
    return all_passed, results

def simulate_data_plane(launch_approved):
    """Simulate Data Plane phase"""
    print()
    print("ðŸ’» DATA PLANE")
    print("-" * 30)
    
    if not launch_approved:
        print("Launch denied âŒ")
        print("Instance state: TERMINATED")
        return
    
    print("Launch approved âœ…")
    time.sleep(0.5)
    
    print("Instance state: PENDING...", end=" ")
    time.sleep(1)
    print("RUNNING âœ…")
    time.sleep(0.5)
    
    print()
    print("Checking connectivity...")
    print("-" * 20)
    
    # Network check
    print("Network connection...", end=" ")
    time.sleep(0.7)
    network_ok = random.random() < 0.7
    if network_ok:
        print("âœ… WORKING")
    else:
        print("âŒ BROKEN (no route to host)")
    
    # IAM Role check
    print("IAM Role attachment...", end=" ")
    time.sleep(0.7)
    iam_ok = random.random() < 0.8
    if iam_ok:
        print("âœ… ATTACHED")
    else:
        print("âŒ NOT ATTACHED")
    
    # SSH access check
    print("SSH access...", end=" ")
    time.sleep(0.7)
    ssh_ok = network_ok and random.random() < 0.6
    if ssh_ok:
        print("âœ… AVAILABLE")
    else:
        print("âŒ UNREACHABLE")
    
    return network_ok, iam_ok

def show_summary(control_passed, data_plane_results):
    """Show launch summary"""
    print()
    print("=" * 50)
    print("ðŸ“Š LAUNCH SUMMARY")
    print("=" * 50)
    
    if not control_passed:
        print("âŒ LAUNCH FAILED - Control Plane denied")
        print()
        print("Root cause:")
        print("-" * 20)
        print("â€¢ IAM permissions missing")
        print("â€¢ AMI not found") 
        print("â€¢ Subnet doesn't exist")
        print("â€¢ Security group issues")
        return
    
    network_ok, iam_ok = data_plane_results
    
    if network_ok and iam_ok:
        print("âœ… LAUNCH SUCCESSFUL!")
        print()
        print("Instance is fully operational:")
        print("- Network: âœ… Working")
        print("- IAM Role: âœ… Attached")
        print("- SSH: âœ… Available")
    else:
        print("âš ï¸ LAUNCH PARTIAL SUCCESS")
        print()
        print("Issues detected:")
        if not network_ok:
            print("- Network: âŒ Broken (check routes)")
        if not iam_ok:
            print("- IAM Role: âŒ Not attached")
        print()
        print("Instance is running but may have issues.")

def quick_simulation():
    """Quick one-run simulation"""
    clear_screen()
    print_header()
    
    print("Simulating EC2 launch request...")
    time.sleep(1)
    print()
    
    # Control Plane
    print("1ï¸âƒ£ CONTROL PLANE PHASE")
    print("=" * 30)
    control_passed, _ = simulate_control_plane()
    
    print()
    
    # Data Plane
    print("2ï¸âƒ£ DATA PLANE PHASE")
    print("=" * 30)
    if control_passed:
        data_results = simulate_data_plane(True)
        show_summary(control_passed, data_results)
    else:
        simulate_data_plane(False)
        show_summary(control_passed, None)
    
    print()
    print("=" * 50)

def main():
    """Main interactive menu"""
    while True:
        clear_screen()
        print_header()
        
        print("What would you like to do?")
        print("1. ðŸš€ Run EC2 launch simulation")
        print("2. ðŸ“š Learn about phases")
        print("3. ðŸ” Run multiple simulations")
        print("0. ðŸšª Exit")
        print()
        
        choice = input("Enter choice (0-3): ").strip()
        
        if choice == "1":
            quick_simulation()
            input("\nPress Enter to continue...")
        
        elif choice == "2":
            clear_screen()
            print_header()
            print("ðŸ“š EC2 LAUNCH PHASES")
            print("=" * 30)
            print()
            
            print("1ï¸âƒ£ CONTROL PLANE (API Checks):")
            print("-" * 25)
            print("â€¢ Checks IAM permissions")
            print("â€¢ Verifies AMI exists")
            print("â€¢ Validates subnet exists")
            print("â€¢ Verifies security groups")
            print("â€¢ Validates key pair")
            print("â†’ If ANY fails: launch denied")
            print()
            
            print("2ï¸âƒ£ DATA PLANE (Actual Launch):")
            print("-" * 25)
            print("â€¢ Instance moves to RUNNING")
            print("â€¢ Network connectivity tested")
            print("â€¢ IAM role attached to instance")
            print("â€¢ SSH access verified")
            print("â†’ Can still fail after control plane")
            print()
            
            print("Key difference:")
            print("Control Plane = PERMISSION to launch")
            print("Data Plane = ACTUAL launch & connectivity")
            
            input("\nPress Enter to continue...")
        
        elif choice == "3":
            clear_screen()
            print_header()
            
            num_runs = input("How many simulations? (1-10): ").strip()
            try:
                num_runs = int(num_runs)
                if num_runs < 1 or num_runs > 10:
                    num_runs = 3
            except:
                num_runs = 3
            
            success_count = 0
            
            for i in range(num_runs):
                print(f"\nRun {i+1}/{num_runs}")
                print("-" * 20)
                
                control_passed = random.random() < 0.7  # 70% pass rate
                
                print("Control Plane...", end=" ")
                if control_passed:
                    print("âœ… PASSED")
                    success_count += 1
                else:
                    print("âŒ FAILED")
                
                time.sleep(0.5)
            
            print()
            print("=" * 30)
            print(f"RESULTS: {success_count}/{num_runs} successful")
            print(f"Success rate: {(success_count/num_runs)*100:.1f}%")
            
            input("\nPress Enter to continue...")
        
        elif choice == "0":
            print("\nGoodbye! ðŸš€")
            break
        
        else:
            print("Invalid choice!")
            time.sleep(1)

# Super simple version (one-liner ready)
def super_simple():
    """Super simple version"""
    print("=" * 40)
    print("EC2 LAUNCH SIMULATOR")
    print("=" * 40)
    print()
    
    print("1ï¸âƒ£ CONTROL PLANE:")
    print("- IAM Permission: âœ… PASS")
    print("- AMI Exists: âœ… PASS") 
    print("- Subnet Exists: âœ… PASS")
    print("- Security Group: âœ… PASS")
    print("- Key Pair: âœ… PASS")
    print("â†’ LAUNCH APPROVED âœ…")
    print()
    
    print("2ï¸âƒ£ DATA PLANE:")
    print("- Instance: RUNNING âœ…")
    print("- Network: âœ… WORKING")
    print("- IAM Role: âœ… ATTACHED")
    print("- SSH: âœ… AVAILABLE")
    print()
    print("âœ… LAUNCH SUCCESSFUL!")
    print("=" * 40)

# Run the tool
if __name__ == "__main__":
    clear_screen()
    
    print("Choose version:")
    print("1. Interactive simulator")
    print("2. Quick one-page view")
    
    choice = input("\nChoice (1 or 2): ").strip()
    
    if choice == "1":
        main()
    else:
        clear_screen()
        super_simple()
